{"ast":null,"code":"import axios from 'axios';\nconst FINNHUB_API_KEY = process.env.REACT_APP_FINNHUB_API_KEY;\nconst FINNHUB_API_BASE_URL = 'https://finnhub.io/api/v1';\n\n// Debug logging\nconsole.log('StockService Debug:');\nconsole.log('API Key available:', FINNHUB_API_KEY ? 'YES' : 'NO');\nconsole.log('API Key length:', FINNHUB_API_KEY ? FINNHUB_API_KEY.length : 0);\nconsole.log('Base URL:', FINNHUB_API_BASE_URL);\n\n// Configure axios defaults for Finnhub\nconst finnhubClient = axios.create({\n  baseURL: FINNHUB_API_BASE_URL,\n  headers: {\n    'X-Finnhub-Token': FINNHUB_API_KEY\n  },\n  timeout: 10000 // 10 second timeout\n});\nexport const stockService = {\n  async getStockData(symbol, timeRange) {\n    try {\n      console.log(`Fetching stock data for symbol: ${symbol}`);\n\n      // Ensure symbol is properly formatted\n      const formattedSymbol = symbol.trim().toUpperCase();\n      console.log(`Formatted symbol: ${formattedSymbol}`);\n\n      // Get real-time quote data\n      console.log('Making API request to /quote endpoint...');\n      const quoteResponse = await finnhubClient.get('/quote', {\n        params: {\n          symbol: formattedSymbol\n        }\n      });\n      console.log('Quote response received:', quoteResponse.data);\n      if (!quoteResponse.data || typeof quoteResponse.data.c !== 'number') {\n        throw new Error(`No quote data available for symbol ${formattedSymbol}. Please check if the symbol is valid.`);\n      }\n      const quote = quoteResponse.data;\n      const currentTimestamp = Math.floor(Date.now() / 1000);\n\n      // Since we can't access historical data with the free API key,\n      // we'll create a simple dataset showing current price, previous close,\n      // and simulate some data points for visualization\n      const dataPoints = [];\n\n      // Add previous close as the first data point\n      if (quote.pc && quote.pc > 0) {\n        dataPoints.push({\n          timestamp: currentTimestamp - 86400,\n          // 24 hours ago\n          price: quote.pc,\n          volume: 0\n        });\n      }\n\n      // Add some intermediate points for better visualization\n      // This simulates price movement between previous close and current price\n      if (quote.pc && quote.pc > 0 && quote.c !== quote.pc) {\n        const priceChange = quote.c - quote.pc;\n        const steps = 5;\n        for (let i = 1; i < steps; i++) {\n          const ratio = i / steps;\n          const interpolatedPrice = quote.pc + priceChange * ratio;\n          dataPoints.push({\n            timestamp: currentTimestamp - 86400 + 86400 * ratio,\n            price: interpolatedPrice,\n            volume: 0\n          });\n        }\n      }\n\n      // Add current price as the final data point\n      dataPoints.push({\n        timestamp: currentTimestamp,\n        price: quote.c,\n        volume: 0\n      });\n      console.log(`Generated ${dataPoints.length} data points for ${formattedSymbol}`);\n      return dataPoints;\n    } catch (error) {\n      var _error$response, _error$response2;\n      console.error('Error fetching stock data:', error);\n      console.error('Error details:', {\n        message: error.message,\n        response: (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data,\n        status: (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status,\n        request: error.request ? 'Request made but no response' : 'No request made'\n      });\n      if (error.response) {\n        var _error$response$data;\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        if (error.response.status === 429) {\n          throw new Error('API rate limit exceeded. Please try again later.');\n        } else if (error.response.status === 403) {\n          throw new Error('Access denied. This endpoint may require a paid API subscription.');\n        } else if (error.response.status === 426) {\n          throw new Error('API upgrade required. Please check your API key and subscription.');\n        } else if (error.response.status === 404) {\n          throw new Error(`Stock symbol \"${symbol}\" not found. Please check the symbol and try again.`);\n        }\n        throw new Error(`API Error: ${((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Unknown error'}`);\n      } else if (error.request) {\n        throw new Error('No response received from Finnhub API. Please check your internet connection.');\n      } else {\n        throw error;\n      }\n    }\n  },\n  async getSymbol(query) {\n    try {\n      var _response$data;\n      const response = await finnhubClient.get('/search', {\n        params: {\n          q: query.trim()\n        }\n      });\n      const results = (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.result;\n      if (!results || !results.length) {\n        throw new Error(`No symbol found for query: ${query}`);\n      }\n\n      // Find the best match (prefer exact matches and US exchanges)\n      const bestMatch = results.find(r => r.symbol.toUpperCase() === query.trim().toUpperCase()) || results[0];\n      return bestMatch.symbol;\n    } catch (error) {\n      console.error('Error fetching symbol:', error);\n      if (error.response) {\n        var _error$response$data2;\n        if (error.response.status === 429) {\n          throw new Error('API rate limit exceeded. Please try again later.');\n        } else if (error.response.status === 403) {\n          throw new Error('Invalid API key or unauthorized access.');\n        }\n        throw new Error(`API Error: ${((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.error) || 'Unknown error'}`);\n      } else if (error.request) {\n        throw new Error('No response received from Finnhub API. Please check your connection.');\n      }\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["axios","FINNHUB_API_KEY","process","env","REACT_APP_FINNHUB_API_KEY","FINNHUB_API_BASE_URL","console","log","length","finnhubClient","create","baseURL","headers","timeout","stockService","getStockData","symbol","timeRange","formattedSymbol","trim","toUpperCase","quoteResponse","get","params","data","c","Error","quote","currentTimestamp","Math","floor","Date","now","dataPoints","pc","push","timestamp","price","volume","priceChange","steps","i","ratio","interpolatedPrice","error","_error$response","_error$response2","message","response","status","request","_error$response$data","getSymbol","query","_response$data","q","results","result","bestMatch","find","r","_error$response$data2"],"sources":["/Users/loaneruser/Documents/GitHub/current/src/services/stockService.ts"],"sourcesContent":["import axios from 'axios';\nimport { StockData } from '../types';\n\nconst FINNHUB_API_KEY = process.env.REACT_APP_FINNHUB_API_KEY;\nconst FINNHUB_API_BASE_URL = 'https://finnhub.io/api/v1';\n\n// Debug logging\nconsole.log('StockService Debug:');\nconsole.log('API Key available:', FINNHUB_API_KEY ? 'YES' : 'NO');\nconsole.log('API Key length:', FINNHUB_API_KEY ? FINNHUB_API_KEY.length : 0);\nconsole.log('Base URL:', FINNHUB_API_BASE_URL);\n\n// Configure axios defaults for Finnhub\nconst finnhubClient = axios.create({\n  baseURL: FINNHUB_API_BASE_URL,\n  headers: {\n    'X-Finnhub-Token': FINNHUB_API_KEY,\n  },\n  timeout: 10000, // 10 second timeout\n});\n\nexport const stockService = {\n  async getStockData(symbol: string, timeRange: string): Promise<StockData[]> {\n    try {\n      console.log(`Fetching stock data for symbol: ${symbol}`);\n      \n      // Ensure symbol is properly formatted\n      const formattedSymbol = symbol.trim().toUpperCase();\n      console.log(`Formatted symbol: ${formattedSymbol}`);\n\n      // Get real-time quote data\n      console.log('Making API request to /quote endpoint...');\n      const quoteResponse = await finnhubClient.get('/quote', {\n        params: {\n          symbol: formattedSymbol,\n        },\n      });\n\n      console.log('Quote response received:', quoteResponse.data);\n\n      if (!quoteResponse.data || typeof quoteResponse.data.c !== 'number') {\n        throw new Error(`No quote data available for symbol ${formattedSymbol}. Please check if the symbol is valid.`);\n      }\n\n      const quote = quoteResponse.data;\n      const currentTimestamp = Math.floor(Date.now() / 1000);\n      \n      // Since we can't access historical data with the free API key,\n      // we'll create a simple dataset showing current price, previous close,\n      // and simulate some data points for visualization\n      const dataPoints: StockData[] = [];\n      \n      // Add previous close as the first data point\n      if (quote.pc && quote.pc > 0) {\n        dataPoints.push({\n          timestamp: currentTimestamp - 86400, // 24 hours ago\n          price: quote.pc,\n          volume: 0,\n        });\n      }\n      \n      // Add some intermediate points for better visualization\n      // This simulates price movement between previous close and current price\n      if (quote.pc && quote.pc > 0 && quote.c !== quote.pc) {\n        const priceChange = quote.c - quote.pc;\n        const steps = 5;\n        \n        for (let i = 1; i < steps; i++) {\n          const ratio = i / steps;\n          const interpolatedPrice = quote.pc + (priceChange * ratio);\n          dataPoints.push({\n            timestamp: currentTimestamp - 86400 + (86400 * ratio),\n            price: interpolatedPrice,\n            volume: 0,\n          });\n        }\n      }\n      \n      // Add current price as the final data point\n      dataPoints.push({\n        timestamp: currentTimestamp,\n        price: quote.c,\n        volume: 0,\n      });\n\n      console.log(`Generated ${dataPoints.length} data points for ${formattedSymbol}`);\n      return dataPoints;\n    } catch (error: any) {\n      console.error('Error fetching stock data:', error);\n      console.error('Error details:', {\n        message: error.message,\n        response: error.response?.data,\n        status: error.response?.status,\n        request: error.request ? 'Request made but no response' : 'No request made'\n      });\n      \n      if (error.response) {\n        // The request was made and the server responded with a status code\n        // that falls out of the range of 2xx\n        if (error.response.status === 429) {\n          throw new Error('API rate limit exceeded. Please try again later.');\n        } else if (error.response.status === 403) {\n          throw new Error('Access denied. This endpoint may require a paid API subscription.');\n        } else if (error.response.status === 426) {\n          throw new Error('API upgrade required. Please check your API key and subscription.');\n        } else if (error.response.status === 404) {\n          throw new Error(`Stock symbol \"${symbol}\" not found. Please check the symbol and try again.`);\n        }\n        throw new Error(`API Error: ${error.response.data?.error || 'Unknown error'}`);\n      } else if (error.request) {\n        throw new Error('No response received from Finnhub API. Please check your internet connection.');\n      } else {\n        throw error;\n      }\n    }\n  },\n\n  async getSymbol(query: string): Promise<string> {\n    try {\n      const response = await finnhubClient.get('/search', {\n        params: {\n          q: query.trim(),\n        },\n      });\n\n      const results = response.data?.result;\n      if (!results || !results.length) {\n        throw new Error(`No symbol found for query: ${query}`);\n      }\n\n      // Find the best match (prefer exact matches and US exchanges)\n      const bestMatch = results.find(\n        (r: any) => r.symbol.toUpperCase() === query.trim().toUpperCase()\n      ) || results[0];\n\n      return bestMatch.symbol;\n    } catch (error: any) {\n      console.error('Error fetching symbol:', error);\n      if (error.response) {\n        if (error.response.status === 429) {\n          throw new Error('API rate limit exceeded. Please try again later.');\n        } else if (error.response.status === 403) {\n          throw new Error('Invalid API key or unauthorized access.');\n        }\n        throw new Error(`API Error: ${error.response.data?.error || 'Unknown error'}`);\n      } else if (error.request) {\n        throw new Error('No response received from Finnhub API. Please check your connection.');\n      }\n      throw error;\n    }\n  },\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}